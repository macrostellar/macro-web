{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/sarahasif/Documents/Software%20Codes/my-tracking%20app/lib/supabase.ts"],"sourcesContent":["import { createClient } from '@supabase/supabase-js';\nimport type { Database } from \"@/lib/database.types\";\n\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL!;\nconst supabaseAnonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!;\n\nif (!supabaseUrl || !supabaseAnonKey) {\n  throw new Error(\"Supabase environment variables are missing\");\n}\n\nexport const supabase = createClient<Database>(supabaseUrl, supabaseAnonKey);\n"],"names":[],"mappings":";;;;AAGoB;AAHpB;;AAGA,MAAM;AACN,MAAM;AAEN;;AAIO,MAAM,WAAW,IAAA,0MAAY,EAAW,aAAa"}},
    {"offset": {"line": 23, "column": 0}, "map": {"version":3,"sources":["file:///Users/sarahasif/Documents/Software%20Codes/my-tracking%20app/contexts/DriverContext.tsx"],"sourcesContent":["\"use client\";\n\n\nimport React, { createContext, useContext, useEffect, useState } from \"react\";\nimport { supabase } from \"../lib/supabase\";\n\ntype Driver = any;\n\ntype DriverContextType = {\n  drivers: Driver[];\n  driversMap: Record<string, Driver>;\n  refreshDrivers: () => Promise<void>;\n  getDriver: (id?: string | null) => Driver | null;\n  setLocalSelectedDriver: (id: string | null) => void;\n  localSelectedDriverId: string | null;\n};\n\nconst DriverContext = createContext<DriverContextType | undefined>(undefined);\n\nexport const DriverProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {\n  const [drivers, setDrivers] = useState<Driver[]>([]);\n  const [localSelectedDriverId, setLocalSelectedDriverId] = useState<string | null>(null);\n\n  const refreshDrivers = async () => {\n    const { data } = await supabase.from(\"drivers\").select(\"*\");\n    setDrivers(data ?? []);\n  };\n\n  useEffect(() => {\n    refreshDrivers();\n  }, []);\n\n  const driversMap = React.useMemo(\n    () => Object.fromEntries(drivers.map((d: any) => [d.id, d])),\n    [drivers]\n  );\n\n  const getDriver = (id?: string | null) => (id ? driversMap[id] ?? null : null);\n\n  return (\n    <DriverContext.Provider\n      value={{\n        drivers,\n        driversMap,\n        refreshDrivers,\n        getDriver,\n        setLocalSelectedDriver: setLocalSelectedDriverId,\n        localSelectedDriverId,\n      }}\n    >\n      {children}\n    </DriverContext.Provider>\n  );\n};\n\nexport const useDrivers = () => {\n  const ctx = useContext(DriverContext);\n  if (!ctx) throw new Error(\"useDrivers must be used within DriverProvider\");\n  return ctx;\n};\n"],"names":[],"mappings":";;;;;;;AAGA;AACA;;;AAJA;;;AAiBA,MAAM,8BAAgB,IAAA,8KAAa,EAAgC;AAE5D,MAAM,iBAA0D,CAAC,EAAE,QAAQ,EAAE;;IAClF,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,yKAAQ,EAAW,EAAE;IACnD,MAAM,CAAC,uBAAuB,yBAAyB,GAAG,IAAA,yKAAQ,EAAgB;IAElF,MAAM,iBAAiB;QACrB,MAAM,EAAE,IAAI,EAAE,GAAG,MAAM,8HAAQ,CAAC,IAAI,CAAC,WAAW,MAAM,CAAC;QACvD,WAAW,QAAQ,EAAE;IACvB;IAEA,IAAA,0KAAS;oCAAC;YACR;QACF;mCAAG,EAAE;IAEL,MAAM,aAAa,wKAAK,CAAC,OAAO;8CAC9B,IAAM,OAAO,WAAW,CAAC,QAAQ,GAAG;sDAAC,CAAC,IAAW;wBAAC,EAAE,EAAE;wBAAE;qBAAE;;6CAC1D;QAAC;KAAQ;IAGX,MAAM,YAAY,CAAC,KAAwB,KAAK,UAAU,CAAC,GAAG,IAAI,OAAO;IAEzE,qBACE,6LAAC,cAAc,QAAQ;QACrB,OAAO;YACL;YACA;YACA;YACA;YACA,wBAAwB;YACxB;QACF;kBAEC;;;;;;AAGP;GAlCa;KAAA;AAoCN,MAAM,aAAa;;IACxB,MAAM,MAAM,IAAA,2KAAU,EAAC;IACvB,IAAI,CAAC,KAAK,MAAM,IAAI,MAAM;IAC1B,OAAO;AACT;IAJa"}},
    {"offset": {"line": 96, "column": 0}, "map": {"version":3,"sources":["file:///Users/sarahasif/Documents/Software%20Codes/my-tracking%20app/contexts/AuthContext.tsx"],"sourcesContent":["\"use client\";\n\nimport { createContext, useContext, useEffect, useState, type ReactNode } from 'react';\nimport { type User, type Session } from '@supabase/supabase-js';\nimport { supabase } from '../lib/supabase';\n\nexport type UserRole = 'super_admin' | 'owner' | 'driver' | null;\n\ninterface Profile {\n  id: string;\n  email: string | null;\n  full_name: string | null;\n  phone: string | null;\n  company_id: string | null;\n  company_name: string | null;\n  username: string | null;\n  role: UserRole;\n  created_at: string | null;\n  updated_at: string | null;\n}\n\ninterface AuthContextType {\n  user: User | null;\n  session: Session | null;\n  profile: Profile | null;\n  role: UserRole;\n  loading: boolean;\n  signUp: (email: string, password: string, fullName?: string) => Promise<{ error: Error | null }>;\n  signIn: (email: string, password: string) => Promise<{ error: Error | null }>;\n  signOut: () => Promise<void>;\n  refreshProfile: () => Promise<void>;\n  isSuperAdmin: boolean;\n  isOwner: boolean;\n  isDriver: boolean;\n  hasPermission: (permission: string) => boolean;\n}\n\nconst AuthContext = createContext<AuthContextType | undefined>(undefined);\n\n// Permission definitions\nconst PERMISSIONS = {\n  super_admin: [\n    'manage_all_users', 'manage_all_vehicles', 'manage_all_drivers',\n    'view_all_reports', 'manage_billing', 'manage_settings', 'view_all_alerts',\n    'manage_own_fleet', 'manage_own_drivers', 'manage_own_vehicles',\n    'view_own_reports', 'view_own_alerts', 'view_assigned_vehicle', 'view_own_trips',\n    'manage_companies', 'manage_subscriptions'\n  ],\n  owner: [\n    'manage_own_fleet', 'manage_own_drivers', 'manage_own_vehicles',\n    'view_own_reports', 'view_own_alerts', 'view_assigned_vehicle', 'view_own_trips'\n  ],\n  driver: [\n    'view_assigned_vehicle', 'view_own_trips'\n  ]\n};\n\nfunction AuthProvider({ children }: { children: ReactNode }) {\n  const [user, setUser] = useState<User | null>(null);\n  const [session, setSession] = useState<Session | null>(null);\n  const [profile, setProfile] = useState<Profile | null>(null);\n  const [role, setRole] = useState<UserRole>(null);\n  const [loading, setLoading] = useState(true);\n\n  const fetchProfile = async (userId: string) => {\n    const { data, error } = await supabase\n      .from('profiles')\n      .select('*')\n      .eq('id', userId)\n      .maybeSingle();\n\n    if (data && !error) {\n      setProfile(data as Profile);\n      setRole(data.role as UserRole);\n    }\n  };\n\n  const refreshProfile = async () => {\n    if (user) {\n      await fetchProfile(user.id);\n    }\n  };\n\n  // Initialize session and auth state\n  useEffect(() => {\n    const initAuth = async () => {\n      const { data } = await supabase.auth.getSession();\n      setSession(data.session);\n      setUser(data.session?.user ?? null);\n      \n      if (data.session?.user) {\n        await fetchProfile(data.session.user.id);\n      }\n      \n      setLoading(false);\n    };\n\n    initAuth();\n\n    const { data: { subscription } } = supabase.auth.onAuthStateChange(async (_event, session) => {\n      setSession(session);\n      setUser(session?.user ?? null);\n      \n      if (session?.user) {\n        await fetchProfile(session.user.id);\n      } else {\n        setProfile(null);\n        setRole(null);\n      }\n      \n      setLoading(false);\n    });\n\n    return () => subscription.unsubscribe();\n  }, []);\n\n  // Sign Up\n  const signUp = async (email: string, password: string, fullName?: string) => {\n    try {\n      const { data, error } = await supabase.auth.signUp({ email, password });\n      if (error) throw error;\n\n      if (data.user && fullName) {\n        // update profile after signup with default role as 'owner'\n        const { error: profileError } = await supabase\n          .from('profiles')\n          .update({ full_name: fullName, role: 'owner' })\n          .eq('id', data.user.id);\n\n        if (profileError) throw profileError;\n      }\n\n      return { error: null };\n    } catch (error) {\n      console.error('SignUp Error:', error);\n      return { error: error as Error };\n    }\n  };\n\n  // Sign In\n  const signIn = async (email: string, password: string) => {\n    try {\n      const { error } = await supabase.auth.signInWithPassword({ email, password });\n      if (error) throw error;\n      return { error: null };\n    } catch (error) {\n      console.error('SignIn Error:', error);\n      return { error: error as Error };\n    }\n  };\n\n  // Sign Out\n  const signOut = async () => {\n    try {\n      // Clear state first to prevent stale UI\n      setUser(null);\n      setSession(null);\n      setProfile(null);\n      setRole(null);\n      // Then sign out from Supabase\n      const { error } = await supabase.auth.signOut();\n      if (error) throw error;\n    } catch (error) {\n      console.error('SignOut Error:', error);\n    }\n  };\n\n  // Role checks\n  const isSuperAdmin = role === 'super_admin';\n  const isOwner = role === 'owner';\n  const isDriver = role === 'driver';\n\n  // Permission check\n  const hasPermission = (permission: string): boolean => {\n    if (!role) return false;\n    const rolePermissions = PERMISSIONS[role] || [];\n    return rolePermissions.includes(permission);\n  };\n\n  return (\n    <AuthContext.Provider value={{ \n      user, session, profile, role, loading, \n      signUp, signIn, signOut, refreshProfile,\n      isSuperAdmin, isOwner, isDriver, hasPermission \n    }}>\n      {children}\n    </AuthContext.Provider>\n  );\n}\n\n// Hook for consuming auth context\nfunction useAuth() {\n  const context = useContext(AuthContext);\n  if (!context) throw new Error('useAuth must be used within an AuthProvider');\n  return context;\n}\n\nexport { AuthProvider, useAuth };\n"],"names":[],"mappings":"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"}}]
}