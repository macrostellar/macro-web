{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/sarahasif/Documents/Software%20Codes/my-tracking%20app/app/%28dashboard%29/live-tracking/page.tsx"],"sourcesContent":["\"use client\";\n\nimport React, { useEffect, useRef, useState, useCallback, useMemo } from \"react\";\nimport mapboxgl from \"mapbox-gl\";\nimport MapboxDraw from \"@mapbox/mapbox-gl-draw\";\nimport { supabase } from \"@/lib/supabase\";\nimport {\n  Search,\n  RefreshCcw,\n  Play,\n  Pause,\n  MapPin,\n  Car,\n  Clock,\n  Navigation,\n  Signal,\n  ChevronLeft,\n  ChevronRight,\n  Gauge,\n  Crosshair,\n  Layers,\n  SkipBack,\n  SkipForward,\n  X,\n  Activity,\n  AlertTriangle,\n  Circle,\n  Map as MapIcon,\n  Eye,\n  EyeOff,\n  Plus,\n  Shield,\n  Compass,\n  Zap,\n  Radio,\n} from \"lucide-react\";\nimport \"mapbox-gl/dist/mapbox-gl.css\";\nimport \"@mapbox/mapbox-gl-draw/dist/mapbox-gl-draw.css\";\n\nmapboxgl.accessToken =\n  \"pk.eyJ1Ijoic2FyYWhhc2lmIiwiYSI6ImNtaWlvdGZ5bTA1Z24zZXNoazZwb3p6Y3kifQ.2olx4jcsvmvcXOoblHiRFA\";\n\ntype Vehicle = {\n  id: string;\n  registration_number?: string | null;\n  last_known_location?: { lat?: number; lng?: number } | null;\n  last_update?: string | null;\n  status?: string | null;\n  assigned_driver_id?: string | null;\n  company_id?: string | null;\n  image_url?: string | null;\n  model?: string | null;\n  vehicle_type?: string | null;\n  brand?: string | null;\n  speed?: number | null;\n  heading?: number | null;\n  latitude?: number | null;\n  longitude?: number | null;\n  ignition_status?: boolean | null;\n};\n\ntype Geofence = {\n  id: string;\n  name: string;\n  boundary: unknown;\n  active: boolean;\n  vehicle_id?: string | null;\n  type?: string | null;\n  speed_limit?: number | null;\n};\n\ntype Alert = {\n  id: string;\n  message: string;\n  severity: string;\n  alert_type: string;\n  vehicle_id?: string | null;\n  geofence_id?: string | null;\n  speed_recorded?: number | null;\n  speed_limit?: number | null;\n  created_at: string;\n  acknowledged: boolean;\n};\n\n// Point in polygon check using ray casting algorithm\nconst isPointInPolygon = (point: [number, number], polygon: number[][]): boolean => {\n  const [x, y] = point;\n  let inside = false;\n  \n  for (let i = 0, j = polygon.length - 1; i < polygon.length; j = i++) {\n    const xi = polygon[i][0], yi = polygon[i][1];\n    const xj = polygon[j][0], yj = polygon[j][1];\n    \n    const intersect = ((yi > y) !== (yj > y)) && (x < (xj - xi) * (y - yi) / (yj - yi) + xi);\n    if (intersect) inside = !inside;\n  }\n  \n  return inside;\n};\n\nconst MAP_STYLES = {\n  streets: \"mapbox://styles/mapbox/streets-v12\",\n  satellite: \"mapbox://styles/mapbox/satellite-streets-v12\",\n  dark: \"mapbox://styles/mapbox/dark-v11\",\n  light: \"mapbox://styles/mapbox/light-v11\",\n};\n\nexport default function LiveTrackingPage() {\n  const mapContainerRef = useRef<HTMLDivElement | null>(null);\n  const mapRef = useRef<mapboxgl.Map | null>(null);\n  const vehicleMarkersRef = useRef<Map<string, mapboxgl.Marker>>(new Map());\n  const drawRef = useRef<MapboxDraw | null>(null);\n\n  // State\n  const [vehicles, setVehicles] = useState<Vehicle[]>([]);\n  const [filteredVehicles, setFilteredVehicles] = useState<Vehicle[]>([]);\n  const [selectedVehicle, setSelectedVehicle] = useState<Vehicle | null>(null);\n  const [search, setSearch] = useState(\"\");\n  const [statusFilter, setStatusFilter] = useState(\"\");\n  const [isSideOpen, setIsSideOpen] = useState(true);\n  const [mapStyle, setMapStyle] = useState<keyof typeof MAP_STYLES>(\"streets\");\n  const [isLoading, setIsLoading] = useState(true);\n  const [showStylePicker, setShowStylePicker] = useState(false);\n\n  // Geofence state\n  const [geofences, setGeofences] = useState<Geofence[]>([]);\n  const [showGeofences, setShowGeofences] = useState(true);\n  const geofenceLayersRef = useRef<Set<string>>(new Set());\n  \n  // Alert state\n  const [liveAlerts, setLiveAlerts] = useState<Alert[]>([]);\n  const [showAlertBanner, setShowAlertBanner] = useState(false);\n  const vehicleGeofenceStateRef = useRef<Map<string, Set<string>>>(new Map()); // Track which vehicles are in which geofences\n  const defaultSpeedLimit = 120; // Default speed limit in km/h\n  \n  // Geofence creation state\n  const [isDrawingGeofence, setIsDrawingGeofence] = useState(false);\n  const [showGeofenceModal, setShowGeofenceModal] = useState(false);\n  const [drawnGeometry, setDrawnGeometry] = useState<GeoJSON.Geometry | null>(null);\n  const [geofenceForm, setGeofenceForm] = useState({\n    name: \"\",\n    description: \"\",\n    vehicle_id: \"\",\n    type: \"both\",\n  });\n\n  // Realtime connection status\n  const [realtimeStatus, setRealtimeStatus] = useState<'connecting' | 'connected' | 'disconnected'>('connecting');\n  const reconnectTimeoutRef = useRef<NodeJS.Timeout | null>(null);\n\n  // Playback state\n  const [playbackPoints, setPlaybackPoints] = useState<\n    { lat: number; lng: number; timestamp: string; speed?: number }[]\n  >([]);\n  const playbackMarkerRef = useRef<mapboxgl.Marker | null>(null);\n  const playbackAnimationRef = useRef<number | null>(null);\n  const [isPlaying, setIsPlaying] = useState(false);\n  const [playbackIdx, setPlaybackIdx] = useState(0);\n  const [playbackDuration, setPlaybackDuration] = useState(0);\n  const [playbackSpeed, setPlaybackSpeed] = useState(1);\n  const [showPlaybackPanel, setShowPlaybackPanel] = useState(false);\n  const [playbackVehicle, setPlaybackVehicle] = useState<Vehicle | null>(null);\n\n  // Realtime channel ref\n  const realtimeChannelRef = useRef<ReturnType<typeof supabase.channel> | null>(null);\n\n  // Stats - memoized to prevent recalculation on every render\n  const stats = useMemo(() => ({\n    total: vehicles.length,\n    moving: vehicles.filter((v) => v.status === \"moving\" || v.status === \"online\" || v.status === \"in_motion\").length,\n    stopped: vehicles.filter((v) => v.status === \"stopped\" || v.status === \"parked\").length,\n    offline: vehicles.filter((v) => v.status === \"offline\" || !v.status).length,\n  }), [vehicles]);\n\n  // --- Load vehicles with latest tracking data ---\n  const loadVehicles = useCallback(async () => {\n    setIsLoading(true);\n    \n    try {\n      // Fetch vehicles and latest tracking in parallel\n      const [vehiclesResult, trackingResult] = await Promise.all([\n        supabase\n          .from(\"vehicles\")\n          .select(\"id, registration_number, last_known_location, last_update, status, assigned_driver_id, company_id, model, vehicle_type, brand, image_url\")\n          .limit(100),\n        supabase\n          .from(\"tracking_data\")\n          .select(\"vehicle_id, location, timestamp, speed, ignition_status, heading\")\n          .order(\"timestamp\", { ascending: false })\n          .limit(200),\n      ]);\n\n      const vehiclesData = vehiclesResult.data;\n      const latestTracking = trackingResult.data;\n\n      if (!vehiclesData) {\n        setIsLoading(false);\n        return;\n      }\n\n      // Create a map of latest tracking per vehicle (more efficient)\n      const latestByVehicle = new Map<string, {\n        location: unknown;\n        timestamp: string;\n        speed?: number | null;\n        ignition_status?: boolean | null;\n        heading?: number | null;\n      }>();\n\n      if (latestTracking) {\n        for (const t of latestTracking) {\n          if (!latestByVehicle.has(t.vehicle_id)) {\n            latestByVehicle.set(t.vehicle_id, t);\n          }\n        }\n      }\n\n    // Parse location helper - handles multiple formats including PostGIS geometry\n    const parseLocation = (loc: unknown): { lat: number; lng: number } | null => {\n      if (!loc) return null;\n      \n      // Already an object with lat/lng\n      if (typeof loc === 'object' && loc !== null) {\n        const obj = loc as Record<string, unknown>;\n        if (typeof obj.lat === 'number' && typeof obj.lng === 'number') {\n          return { lat: obj.lat, lng: obj.lng };\n        }\n        // GeoJSON Point format\n        if ('coordinates' in obj && Array.isArray(obj.coordinates)) {\n          const coords = obj.coordinates as number[];\n          if (coords.length >= 2) {\n            return { lng: coords[0], lat: coords[1] };\n          }\n        }\n        // Object with x/y\n        if (typeof obj.x === 'number' && typeof obj.y === 'number') {\n          return { lng: obj.x, lat: obj.y };\n        }\n      }\n      \n      // WKT string (including SRID prefix)\n      if (typeof loc === 'string') {\n        // Remove SRID prefix if present\n        const cleanLoc = loc.replace(/^SRID=\\d+;/, '');\n        const pointMatch = cleanLoc.match(/POINT\\s*\\(\\s*([+-]?\\d+\\.?\\d*)\\s+([+-]?\\d+\\.?\\d*)\\s*\\)/i);\n        if (pointMatch) {\n          return { lng: parseFloat(pointMatch[1]), lat: parseFloat(pointMatch[2]) };\n        }\n      }\n      \n      return null;\n    };\n\n    const normalized = (vehiclesData as unknown as Vehicle[]).map((v) => {\n      const latestTrack = latestByVehicle.get(v.id);\n      \n      // Use tracking_data if it's more recent than vehicles table\n      let location = v.last_known_location && typeof v.last_known_location === \"object\"\n        ? v.last_known_location\n        : null;\n      let lastUpdate = v.last_update;\n      let status = v.status;\n      let speed: number | null = null;\n      let heading: number | null = null;\n      let latitude: number | null = null;\n      let longitude: number | null = null;\n      let ignition_status: boolean | null = null;\n\n      if (latestTrack) {\n        // Parse the location column (PostGIS geometry or JSON)\n        const parsedLoc = parseLocation(latestTrack.location);\n        if (parsedLoc) {\n          const trackTime = new Date(latestTrack.timestamp).getTime();\n          const vehicleTime = lastUpdate ? new Date(lastUpdate).getTime() : 0;\n          \n          if (trackTime > vehicleTime) {\n            location = parsedLoc;\n            latitude = parsedLoc.lat;\n            longitude = parsedLoc.lng;\n            lastUpdate = latestTrack.timestamp;\n            status = latestTrack.ignition_status ? \"moving\" : \"stopped\";\n            speed = typeof latestTrack.speed === 'number' ? latestTrack.speed : null;\n            heading = typeof latestTrack.heading === 'number' ? latestTrack.heading : null;\n            ignition_status = latestTrack.ignition_status ?? null;\n          }\n        }\n      }\n\n      return {\n        ...v,\n        last_known_location: location,\n        last_update: lastUpdate,\n        status: status,\n        speed: speed,\n        heading: heading,\n        latitude: latitude,\n        longitude: longitude,\n        ignition_status: ignition_status,\n      };\n    });\n\n    // Sort vehicles: moving/active first, then by last update\n    const sortedVehicles = normalized.sort((a, b) => {\n      const aActive = a.status === 'moving' || a.status === 'online' || a.status === 'in_motion';\n      const bActive = b.status === 'moving' || b.status === 'online' || b.status === 'in_motion';\n      if (aActive && !bActive) return -1;\n      if (!aActive && bActive) return 1;\n      // Then by last update (most recent first)\n      const aTime = a.last_update ? new Date(a.last_update).getTime() : 0;\n      const bTime = b.last_update ? new Date(b.last_update).getTime() : 0;\n      return bTime - aTime;\n    });\n\n    const uniqueVehicles = Array.from(\n      new Map(sortedVehicles.map((v: Vehicle) => [v.id, v])).values()\n    );\n    setVehicles(uniqueVehicles);\n    } catch (error) {\n      console.error(\"Error loading vehicles:\", error);\n    } finally {\n      setIsLoading(false);\n    }\n  }, []);\n\n  // --- Load geofences ---\n  const loadGeofences = useCallback(async () => {\n    // Use RPC to get boundary as GeoJSON since PostGIS stores it as binary WKB\n    // The RPC function needs to be created in Supabase first\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    const { data, error } = await (supabase.rpc as any)('get_geofences_with_geojson');\n    \n    if (error) {\n      // Fallback to regular query if RPC doesn't exist\n      console.log('RPC not available, trying direct query with ST_AsGeoJSON');\n      const { data: fallbackData } = await supabase\n        .from(\"geofences\")\n        .select(\"id, name, boundary, active, vehicle_id, type\")\n        .eq(\"active\", true);\n      \n      // Try to parse the boundary - it might be WKB hex\n      const parsedGeofences = (fallbackData || []).map((g: any) => {\n        // If boundary is a hex string (WKB), we can't parse it client-side easily\n        // But if it's already GeoJSON object, use it\n        let parsedBoundary = g.boundary;\n        if (typeof g.boundary === 'object' && g.boundary?.type && g.boundary?.coordinates) {\n          parsedBoundary = g.boundary;\n        }\n        return { ...g, boundary: parsedBoundary };\n      });\n      \n      setGeofences(parsedGeofences as Geofence[]);\n      return;\n    }\n\n    setGeofences((data || []) as Geofence[]);\n  }, []);\n\n  // Check geofence violations for a vehicle\n  const checkGeofenceViolations = useCallback(async (\n    vehicleId: string, \n    vehicleName: string,\n    lat: number, \n    lng: number,\n    speed: number | null\n  ) => {\n    if (geofences.length === 0) return;\n\n    const currentVehicleState = vehicleGeofenceStateRef.current.get(vehicleId) || new Set<string>();\n    const newGeofenceState = new Set<string>();\n\n    for (const geofence of geofences) {\n      const geometry = parseBoundary(geofence.boundary);\n      if (!geometry || geometry.type !== 'Polygon') continue;\n\n      // Check if vehicle is inside geofence\n      const coordinates = geometry.coordinates[0]; // First ring (outer polygon)\n      const isInside = isPointInPolygon([lng, lat], coordinates);\n      \n      if (isInside) {\n        newGeofenceState.add(geofence.id);\n        \n        // Check for entry alert\n        if (!currentVehicleState.has(geofence.id)) {\n          // Vehicle just entered geofence\n          if (geofence.type === 'entry' || geofence.type === 'both') {\n            const alert: Alert = {\n              id: `${vehicleId}-${geofence.id}-entry-${Date.now()}`,\n              message: `${vehicleName} entered geofence: ${geofence.name}`,\n              severity: 'medium',\n              alert_type: 'geofence_entry',\n              vehicle_id: vehicleId,\n              geofence_id: geofence.id,\n              created_at: new Date().toISOString(),\n              acknowledged: false,\n            };\n            setLiveAlerts(prev => [alert, ...prev].slice(0, 50));\n            setShowAlertBanner(true);\n            \n            // Save to database\n            saveAlert(alert, vehicleId, geofence.id);\n          }\n        }\n\n        // Check speed limit within geofence\n        if (geofence.speed_limit && speed && speed > geofence.speed_limit) {\n          const alert: Alert = {\n            id: `${vehicleId}-speed-${geofence.id}-${Date.now()}`,\n            message: `${vehicleName} speeding in ${geofence.name}: ${speed.toFixed(0)} km/h (limit: ${geofence.speed_limit} km/h)`,\n            severity: 'high',\n            alert_type: 'speed_violation',\n            vehicle_id: vehicleId,\n            geofence_id: geofence.id,\n            speed_recorded: speed,\n            speed_limit: geofence.speed_limit,\n            created_at: new Date().toISOString(),\n            acknowledged: false,\n          };\n          setLiveAlerts(prev => [alert, ...prev].slice(0, 50));\n          setShowAlertBanner(true);\n          saveAlert(alert, vehicleId, geofence.id);\n        }\n      } else {\n        // Check for exit alert\n        if (currentVehicleState.has(geofence.id)) {\n          // Vehicle just exited geofence\n          if (geofence.type === 'exit' || geofence.type === 'both') {\n            const alert: Alert = {\n              id: `${vehicleId}-${geofence.id}-exit-${Date.now()}`,\n              message: `${vehicleName} exited geofence: ${geofence.name}`,\n              severity: 'medium',\n              alert_type: 'geofence_exit',\n              vehicle_id: vehicleId,\n              geofence_id: geofence.id,\n              created_at: new Date().toISOString(),\n              acknowledged: false,\n            };\n            setLiveAlerts(prev => [alert, ...prev].slice(0, 50));\n            setShowAlertBanner(true);\n            saveAlert(alert, vehicleId, geofence.id);\n          }\n        }\n      }\n    }\n\n    // Update vehicle geofence state\n    vehicleGeofenceStateRef.current.set(vehicleId, newGeofenceState);\n\n    // Check global speed limit\n    if (speed && speed > defaultSpeedLimit) {\n      // Only alert once per 60 seconds per vehicle for speed\n      const lastSpeedAlertKey = `${vehicleId}-speed-global`;\n      const lastAlert = liveAlerts.find(a => a.id.startsWith(lastSpeedAlertKey));\n      const shouldAlert = !lastAlert || (Date.now() - new Date(lastAlert.created_at).getTime() > 60000);\n      \n      if (shouldAlert) {\n        const alert: Alert = {\n          id: `${lastSpeedAlertKey}-${Date.now()}`,\n          message: `${vehicleName} exceeded speed limit: ${speed.toFixed(0)} km/h (limit: ${defaultSpeedLimit} km/h)`,\n          severity: 'high',\n          alert_type: 'speed_violation',\n          vehicle_id: vehicleId,\n          speed_recorded: speed,\n          speed_limit: defaultSpeedLimit,\n          created_at: new Date().toISOString(),\n          acknowledged: false,\n        };\n        setLiveAlerts(prev => [alert, ...prev].slice(0, 50));\n        setShowAlertBanner(true);\n        saveAlert(alert, vehicleId, null);\n      }\n    }\n  }, [geofences, liveAlerts]);\n\n  // Save alert to database\n  const saveAlert = async (alert: Alert, vehicleId: string, geofenceId: string | null) => {\n    try {\n      const { data: { user } } = await supabase.auth.getUser();\n      if (!user) return;\n\n      await supabase.from('alerts').insert({\n        user_id: user.id,\n        vehicle_id: vehicleId,\n        geofence_id: geofenceId,\n        message: alert.message,\n        severity: alert.severity,\n        alert_type: alert.alert_type,\n        speed_recorded: alert.speed_recorded,\n        speed_limit: alert.speed_limit,\n        acknowledged: false,\n      });\n    } catch (error) {\n      console.error('Failed to save alert:', error);\n    }\n  };\n\n  // Parse WKT to GeoJSON\n  const wktToGeoJson = (wkt: string): { type: string; coordinates: number[][][] } | null => {\n    try {\n      const cleanWkt = wkt.replace(/^SRID=\\d+;/, \"\");\n      const polygonMatch = cleanWkt.match(/POLYGON\\s*\\(\\((.+)\\)\\)/i);\n      if (!polygonMatch) return null;\n\n      const coordsStr = polygonMatch[1];\n      const rings = coordsStr.split(\"),(\").map((ring) =>\n        ring.replace(/[()]/g, \"\").split(\",\").map((pair) => {\n          const [lng, lat] = pair.trim().split(/\\s+/).map(Number);\n          return [lng, lat];\n        })\n      );\n\n      return { type: \"Polygon\", coordinates: rings };\n    } catch {\n      return null;\n    }\n  };\n\n  // Parse boundary to GeoJSON\n  const parseBoundary = (boundary: unknown): { type: string; coordinates: number[][][] } | null => {\n    if (!boundary) return null;\n\n    try {\n      if (typeof boundary === \"string\") {\n        // Check if WKT format\n        if (boundary.includes(\"POLYGON\") || boundary.includes(\"POINT\")) {\n          return wktToGeoJson(boundary);\n        }\n        // Try JSON parse\n        const parsed = JSON.parse(boundary);\n        if (parsed.type && parsed.coordinates) {\n          return parsed;\n        }\n      } else if (typeof boundary === \"object\" && boundary !== null) {\n        const b = boundary as { type?: string; coordinates?: number[][][] };\n        if (b.type && b.coordinates) {\n          return { type: b.type, coordinates: b.coordinates };\n        }\n      }\n    } catch {\n      return null;\n    }\n    return null;\n  };\n\n  // Apply filters\n  useEffect(() => {\n    const list = vehicles.filter((v) => {\n      if (search.trim()) {\n        const s = search.toLowerCase();\n        const rn = String(v.registration_number || \"\").toLowerCase();\n        const brand = String(v.brand || \"\").toLowerCase();\n        const model = String(v.model || \"\").toLowerCase();\n        if (!rn.includes(s) && !brand.includes(s) && !model.includes(s))\n          return false;\n      }\n      if (statusFilter) {\n        // Handle \"moving\" filter to include in_motion, moving, and online statuses\n        if (statusFilter === \"moving\") {\n          if (v.status !== \"moving\" && v.status !== \"in_motion\" && v.status !== \"online\") return false;\n        } else if (statusFilter === \"stopped\") {\n          if (v.status !== \"stopped\" && v.status !== \"parked\") return false;\n        } else if (statusFilter === \"offline\") {\n          if (v.status && v.status !== \"offline\") return false;\n        } else if (v.status !== statusFilter) {\n          return false;\n        }\n      }\n      return true;\n    });\n    setFilteredVehicles(list);\n  }, [vehicles, search, statusFilter]);\n\n  // --- Init map ---\n  useEffect(() => {\n    if (mapRef.current) return;\n    if (!mapContainerRef.current) return;\n\n    const map = new mapboxgl.Map({\n      container: mapContainerRef.current,\n      style: MAP_STYLES[mapStyle],\n      center: [67.0011, 24.8607],\n      zoom: 11,\n      pitch: 0,\n      bearing: 0,\n    });\n\n    mapRef.current = map;\n\n    // Add draw control for geofence creation\n    const draw = new MapboxDraw({\n      displayControlsDefault: false,\n      controls: {\n        polygon: false,\n        trash: false,\n      },\n    });\n    map.addControl(draw, \"top-left\");\n    drawRef.current = draw;\n\n    // Handle draw events\n    map.on(\"draw.create\", (e: { features: GeoJSON.Feature[] }) => {\n      const feature = e.features[0];\n      if (feature?.geometry) {\n        setDrawnGeometry(feature.geometry);\n        setShowGeofenceModal(true);\n        setIsDrawingGeofence(false);\n      }\n    });\n\n    // Ensure map resizes properly after mount\n    map.on('load', () => {\n      map.resize();\n    });\n\n    map.addControl(new mapboxgl.NavigationControl({ showCompass: true }), \"bottom-right\");\n    \n    // Only add GeolocateControl if geolocation is supported and available\n    if (typeof window !== 'undefined' && 'geolocation' in navigator) {\n      // Check if geolocation is actually available (not just the API)\n      navigator.permissions?.query({ name: 'geolocation' }).then((result) => {\n        if (result.state !== 'denied') {\n          map.addControl(\n            new mapboxgl.GeolocateControl({\n              positionOptions: { enableHighAccuracy: true },\n              trackUserLocation: true,\n            }),\n            \"bottom-right\"\n          );\n        }\n      }).catch(() => {\n        // Permissions API not supported, try adding anyway\n        map.addControl(\n          new mapboxgl.GeolocateControl({\n            positionOptions: { enableHighAccuracy: true },\n            trackUserLocation: true,\n          }),\n          \"bottom-right\"\n        );\n      });\n    }\n\n    // Also resize after a short delay to handle layout shifts\n    const resizeTimer = setTimeout(() => {\n      map.resize();\n    }, 100);\n\n    return () => {\n      clearTimeout(resizeTimer);\n      map.remove();\n      mapRef.current = null;\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  // Update map style\n  useEffect(() => {\n    if (mapRef.current) {\n      mapRef.current.setStyle(MAP_STYLES[mapStyle]);\n    }\n  }, [mapStyle]);\n\n  // Resize map when sidebar toggles\n  useEffect(() => {\n    if (mapRef.current) {\n      setTimeout(() => {\n        mapRef.current?.resize();\n      }, 350);\n    }\n  }, [isSideOpen]);\n\n  // --- Draw geofences on map ---\n  useEffect(() => {\n    const map = mapRef.current;\n    if (!map) return;\n\n    const drawGeofences = () => {\n      // Remove old geofence layers and sources (layers first, then sources)\n      geofenceLayersRef.current.forEach((sourceId) => {\n        const fillLayerId = `geofence-fill-${sourceId.replace('geofence-', '')}`;\n        const outlineLayerId = `geofence-outline-${sourceId.replace('geofence-', '')}`;\n        \n        try {\n          if (map.getLayer(fillLayerId)) map.removeLayer(fillLayerId);\n          if (map.getLayer(outlineLayerId)) map.removeLayer(outlineLayerId);\n          if (map.getSource(sourceId)) map.removeSource(sourceId);\n        } catch (e) {\n          console.warn(\"Error removing geofence layer:\", e);\n        }\n      });\n      geofenceLayersRef.current.clear();\n\n      if (!showGeofences) return;\n\n      // Add new geofence layers\n      geofences.forEach((geofence) => {\n        const geometry = parseBoundary(geofence.boundary);\n        if (!geometry) return;\n\n        const sourceId = `geofence-${geofence.id}`;\n        const layerId = `geofence-fill-${geofence.id}`;\n        const outlineId = `geofence-outline-${geofence.id}`;\n\n        // Skip if source already exists\n        if (map.getSource(sourceId)) {\n          geofenceLayersRef.current.add(sourceId);\n          return;\n        }\n\n        // Determine color based on type\n        let fillColor = \"#3b82f6\"; // blue default\n        let outlineColor = \"#2563eb\";\n        if (geofence.type === \"entry\") {\n          fillColor = \"#22c55e\"; // green\n          outlineColor = \"#16a34a\";\n        } else if (geofence.type === \"exit\") {\n          fillColor = \"#ef4444\"; // red\n          outlineColor = \"#dc2626\";\n        }\n\n        try {\n          map.addSource(sourceId, {\n            type: \"geojson\",\n            data: {\n              type: \"Feature\",\n              properties: { name: geofence.name, type: geofence.type },\n              geometry: geometry as GeoJSON.Geometry,\n            },\n          });\n\n          map.addLayer({\n            id: layerId,\n            type: \"fill\",\n            source: sourceId,\n            paint: {\n              \"fill-color\": fillColor,\n              \"fill-opacity\": 0.2,\n            },\n          });\n\n          map.addLayer({\n            id: outlineId,\n            type: \"line\",\n            source: sourceId,\n            paint: {\n              \"line-color\": outlineColor,\n              \"line-width\": 2,\n              \"line-dasharray\": [2, 2],\n            },\n          });\n\n          geofenceLayersRef.current.add(sourceId);\n\n          // Add popup on click\n          map.on(\"click\", layerId, (e) => {\n            const coordinates = e.lngLat;\n            const name = geofence.name;\n            const type = geofence.type || \"both\";\n\n            new mapboxgl.Popup()\n              .setLngLat(coordinates)\n              .setHTML(`\n                <div class=\"p-2\">\n                  <p class=\"font-semibold text-slate-900\">${name}</p>\n                  <p class=\"text-sm text-slate-600\">Trigger: ${type}</p>\n                </div>\n              `)\n              .addTo(map);\n          });\n\n          map.on(\"mouseenter\", layerId, () => {\n            map.getCanvas().style.cursor = \"pointer\";\n          });\n\n          map.on(\"mouseleave\", layerId, () => {\n            map.getCanvas().style.cursor = \"\";\n          });\n        } catch (e) {\n          console.error(\"Error adding geofence layer:\", e);\n        }\n      });\n    };\n\n    // Wait for map style to load before adding layers\n    if (map.isStyleLoaded()) {\n      drawGeofences();\n    } else {\n      map.on(\"style.load\", drawGeofences);\n    }\n\n    return () => {\n      map.off(\"style.load\", drawGeofences);\n    };\n  }, [geofences, showGeofences, mapStyle]);\n\n  // --- Update vehicle markers ---\n  useEffect(() => {\n    const map = mapRef.current;\n    if (!map) return;\n\n    // Remove old markers that no longer exist\n    vehicleMarkersRef.current.forEach((marker, id) => {\n      if (!vehicles.find((v) => v.id === id)) {\n        marker.remove();\n        vehicleMarkersRef.current.delete(id);\n      }\n    });\n\n    // Update or add markers\n    vehicles.forEach((v) => {\n      if (!v.last_known_location?.lng || !v.last_known_location?.lat) return;\n\n      const isSelected = selectedVehicle?.id === v.id;\n      const isMoving = v.status === \"moving\" || v.status === \"online\" || v.status === \"in_motion\";\n      const vehicleName = v.registration_number || v.brand || 'Vehicle';\n\n      // Remove existing marker to recreate with updated state\n      if (vehicleMarkersRef.current.has(v.id)) {\n        vehicleMarkersRef.current.get(v.id)!.remove();\n        vehicleMarkersRef.current.delete(v.id);\n      }\n\n      // Create marker with current state\n      const el = document.createElement(\"div\");\n      el.className = \"vehicle-marker\";\n      el.innerHTML = `\n        <div class=\"relative cursor-pointer group flex flex-col items-center\">\n          <!-- Vehicle Label -->\n          <div class=\"absolute -top-7 left-1/2 -translate-x-1/2 whitespace-nowrap\">\n            <div class=\"px-2 py-0.5 bg-slate-900/90 backdrop-blur-sm rounded text-xs font-medium text-white shadow-lg border border-slate-700\">\n              ${vehicleName}\n            </div>\n          </div>\n          <!-- Vehicle Icon -->\n          <div class=\"w-10 h-10 rounded-full flex items-center justify-center shadow-lg transition-all duration-300 ${\n            isMoving\n              ? \"bg-green-500\"\n              : \"bg-slate-600\"\n          } ${isSelected ? \"ring-4 ring-blue-400 scale-125\" : \"\"}\">\n            <svg class=\"w-5 h-5 text-white\" fill=\"currentColor\" viewBox=\"0 0 24 24\">\n              <path d=\"M18.92 6.01C18.72 5.42 18.16 5 17.5 5h-11c-.66 0-1.21.42-1.42 1.01L3 12v8c0 .55.45 1 1 1h1c.55 0 1-.45 1-1v-1h12v1c0 .55.45 1 1 1h1c.55 0 1-.45 1-1v-8l-2.08-5.99zM6.5 16c-.83 0-1.5-.67-1.5-1.5S5.67 13 6.5 13s1.5.67 1.5 1.5S7.33 16 6.5 16zm11 0c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5zM5 11l1.5-4.5h11L19 11H5z\"/>\n            </svg>\n          </div>\n          ${isMoving ? '<div class=\"absolute top-0 right-0 w-3 h-3 bg-green-400 rounded-full animate-ping\"></div>' : ''}\n        </div>\n      `;\n\n      const marker = new mapboxgl.Marker({ element: el })\n        .setLngLat([v.last_known_location.lng, v.last_known_location.lat])\n        .addTo(map);\n\n      el.addEventListener(\"click\", () => {\n        setSelectedVehicle(v);\n        map.flyTo({\n          center: [v.last_known_location!.lng!, v.last_known_location!.lat!],\n          zoom: 16,\n          duration: 1000,\n        });\n      });\n\n      vehicleMarkersRef.current.set(v.id, marker);\n    });\n  }, [vehicles, selectedVehicle]);\n\n  // --- Realtime subscription ---\n  useEffect(() => {\n    const setupRealtimeSubscription = () => {\n      if (realtimeChannelRef.current) {\n        supabase.removeChannel(realtimeChannelRef.current);\n      }\n\n      setRealtimeStatus('connecting');\n\n      const handleTrackingUpdate = (payload: { new: Record<string, unknown> }) => {\n        console.log('üìç Realtime tracking update received:', payload.new);\n        \n        const record = payload.new as { \n          vehicle_id?: string; \n          location?: { coordinates?: number[]; type?: string } | string; \n          latitude?: number | string | null;\n          longitude?: number | string | null;\n          timestamp?: string; \n          ignition_status?: boolean; \n          speed?: number | string;\n          heading?: number;\n        };\n        \n        // Handle various location formats\n        let lng: number | undefined;\n        let lat: number | undefined;\n        \n        // First check direct latitude/longitude columns (primary format from mobile app)\n        if (record?.latitude != null && record?.longitude != null) {\n          lat = typeof record.latitude === 'number' ? record.latitude : parseFloat(String(record.latitude));\n          lng = typeof record.longitude === 'number' ? record.longitude : parseFloat(String(record.longitude));\n        }\n        // Fallback to location column\n        else if (record?.location) {\n          const loc = record.location;\n          \n          // Format 1: GeoJSON Point { type: \"Point\", coordinates: [lng, lat] }\n          if (typeof loc === 'object' && 'coordinates' in loc && Array.isArray(loc.coordinates)) {\n            [lng, lat] = loc.coordinates;\n          }\n          // Format 2: WKT string \"POINT(lng lat)\" or \"SRID=4326;POINT(lng lat)\"\n          else if (typeof loc === 'string') {\n            const pointMatch = loc.match(/POINT\\s*\\(\\s*([+-]?\\d+\\.?\\d*)\\s+([+-]?\\d+\\.?\\d*)\\s*\\)/i);\n            if (pointMatch) {\n              lng = parseFloat(pointMatch[1]);\n              lat = parseFloat(pointMatch[2]);\n            }\n          }\n          // Format 3: Object with x/y or lng/lat\n          else if (typeof loc === 'object') {\n            const locObj = loc as Record<string, unknown>;\n            if (typeof locObj.lng === 'number' && typeof locObj.lat === 'number') {\n              lng = locObj.lng;\n              lat = locObj.lat;\n            } else if (typeof locObj.x === 'number' && typeof locObj.y === 'number') {\n              lng = locObj.x;\n              lat = locObj.y;\n            }\n          }\n        }\n        \n        if (!lat || !lng || isNaN(lat) || isNaN(lng) || !record.vehicle_id) {\n          console.log('‚ö†Ô∏è Could not parse location from payload:', record);\n          return;\n        }\n        \n        console.log(`üöó Updating vehicle ${record.vehicle_id} to [${lat}, ${lng}]`);\n\n        // Parse speed to number\n        const speed = record.speed != null \n          ? (typeof record.speed === 'number' ? record.speed : parseFloat(String(record.speed)))\n          : null;\n\n        // Parse heading\n        const heading = record.heading != null\n          ? (typeof record.heading === 'number' ? record.heading : parseFloat(String(record.heading)))\n          : null;\n\n        const updateData = {\n          last_known_location: { lat, lng },\n          latitude: lat,\n          longitude: lng,\n          last_update: record.timestamp || new Date().toISOString(),\n          status: record.ignition_status ? \"moving\" : \"stopped\",\n          speed: speed,\n          heading: heading,\n          ignition_status: record.ignition_status ?? null,\n        };\n\n        setVehicles((prev) => {\n          const existingVehicle = prev.find(v => v.id === record.vehicle_id);\n          if (existingVehicle) {\n            // Update existing vehicle\n            return prev.map((v) =>\n              v.id === record.vehicle_id\n                ? { ...v, ...updateData }\n                : v\n            );\n          } else if (record.vehicle_id) {\n            // Add new vehicle if it doesn't exist in the list\n            console.log(`üì• Adding new vehicle ${record.vehicle_id} to tracking list`);\n            const newVehicle: Vehicle = {\n              id: record.vehicle_id,\n              registration_number: null,\n              ...updateData,\n            };\n            return [newVehicle, ...prev];\n          }\n          return prev;\n        });\n\n        // Check for geofence violations and speed alerts\n        const vehicleName = vehicles.find(v => v.id === record.vehicle_id)?.registration_number || 'Vehicle';\n        checkGeofenceViolations(record.vehicle_id, vehicleName, lat, lng, speed);\n\n        // Also update selected vehicle if it's the same one\n        setSelectedVehicle((prev) => {\n          if (prev?.id === record.vehicle_id) {\n            return { ...prev, ...updateData } as Vehicle;\n          }\n          return prev;\n        });\n      };\n\n      const channel = supabase\n        .channel(\"vehicle_tracking\")\n        .on(\n          \"postgres_changes\",\n          { event: \"INSERT\", schema: \"public\", table: \"tracking_data\" },\n          handleTrackingUpdate\n        )\n        .on(\n          \"postgres_changes\",\n          { event: \"UPDATE\", schema: \"public\", table: \"tracking_data\" },\n          handleTrackingUpdate\n        )\n        .subscribe((status) => {\n          if (status === 'SUBSCRIBED') {\n            setRealtimeStatus('connected');\n            console.log('‚úÖ Realtime connected to tracking_data');\n          } else if (status === 'CHANNEL_ERROR' || status === 'TIMED_OUT') {\n            setRealtimeStatus('disconnected');\n            console.log('‚ùå Realtime disconnected, attempting reconnect...');\n            \n            // Auto-reconnect after 3 seconds\n            if (reconnectTimeoutRef.current) {\n              clearTimeout(reconnectTimeoutRef.current);\n            }\n            reconnectTimeoutRef.current = setTimeout(() => {\n              setupRealtimeSubscription();\n            }, 3000);\n          } else if (status === 'CLOSED') {\n            setRealtimeStatus('disconnected');\n          }\n        });\n\n      realtimeChannelRef.current = channel;\n    };\n\n    setupRealtimeSubscription();\n\n    return () => {\n      if (reconnectTimeoutRef.current) {\n        clearTimeout(reconnectTimeoutRef.current);\n      }\n      if (realtimeChannelRef.current) {\n        supabase.removeChannel(realtimeChannelRef.current);\n      }\n    };\n  }, []);\n\n  // Load initial data\n  useEffect(() => {\n    loadVehicles();\n    loadGeofences();\n  }, [loadVehicles, loadGeofences]);\n\n  // Polling fallback - only poll when realtime is disconnected\n  useEffect(() => {\n    // Only poll if realtime is not connected\n    if (realtimeStatus === 'connected') return;\n    \n    const pollInterval = setInterval(() => {\n      loadVehicles();\n    }, 15000); // 15 seconds when disconnected\n\n    return () => clearInterval(pollInterval);\n  }, [loadVehicles, realtimeStatus]);\n\n  // --- Playback functions ---\n  const fetchHistory = async (vehicleId: string, hours = 6) => {\n    const since = new Date(Date.now() - hours * 60 * 60 * 1000).toISOString();\n    const { data, error } = await supabase\n      .from(\"tracking_data\")\n      .select(\"timestamp, location, speed\")\n      .eq(\"vehicle_id\", vehicleId)\n      .gte(\"timestamp\", since)\n      .order(\"timestamp\", { ascending: true })\n      .limit(5000);\n\n    if (error) {\n      console.error(\"Error fetching history:\", error);\n      return [];\n    }\n    \n    if (!data || data.length === 0) {\n      console.log(\"No tracking data found for vehicle\", vehicleId, \"since\", since);\n      return [];\n    }\n\n    console.log(`Found ${data.length} tracking records for playback`);\n\n    return data.map((p: { \n      timestamp: string; \n      location?: unknown; \n      speed?: number | null;\n    }) => {\n      let lat: number | undefined;\n      let lng: number | undefined;\n      \n      // Parse location column (PostGIS geometry or JSON)\n      if (p.location) {\n        const loc = p.location;\n        \n        // Format 1: Object with lat/lng\n        if (typeof loc === 'object' && loc !== null) {\n          const obj = loc as Record<string, unknown>;\n          if (typeof obj.lat === 'number' && typeof obj.lng === 'number') {\n            lat = obj.lat;\n            lng = obj.lng;\n          }\n          // GeoJSON { type: \"Point\", coordinates: [lng, lat] }\n          else if ('coordinates' in obj && Array.isArray(obj.coordinates)) {\n            const coords = obj.coordinates as number[];\n            if (coords.length >= 2) {\n              [lng, lat] = coords;\n            }\n          }\n        }\n        // Format 2: WKT string \"POINT(lng lat)\"\n        else if (typeof loc === 'string') {\n          const cleanLoc = loc.replace(/^SRID=\\d+;/, '');\n          const pointMatch = cleanLoc.match(/POINT\\s*\\(\\s*([+-]?\\d+\\.?\\d*)\\s+([+-]?\\d+\\.?\\d*)\\s*\\)/i);\n          if (pointMatch) {\n            lng = parseFloat(pointMatch[1]);\n            lat = parseFloat(pointMatch[2]);\n          }\n        }\n      }\n      \n      // Parse speed (could be string or number)\n      const speed = p.speed != null \n        ? (typeof p.speed === 'number' ? p.speed : undefined)\n        : undefined;\n      \n      return {\n        lat: lat ?? NaN,\n        lng: lng ?? NaN,\n        timestamp: p.timestamp,\n        speed: speed,\n      };\n    }).filter(p => !isNaN(p.lat) && !isNaN(p.lng)); // Filter out invalid points\n  };\n\n  const handleStartPlayback = async (vehicle: Vehicle, hours = 6) => {\n    const points = await fetchHistory(vehicle.id, hours);\n    if (!points.length) {\n      alert(\"No history found for this vehicle in the selected timeframe.\");\n      return;\n    }\n\n    // Validate first point has valid coordinates\n    if (isNaN(points[0].lat) || isNaN(points[0].lng)) {\n      alert(\"Unable to parse location data for playback.\");\n      return;\n    }\n\n    setPlaybackVehicle(vehicle);\n    setPlaybackPoints(points);\n    setPlaybackIdx(0);\n    setPlaybackDuration(points.length - 1);\n    setShowPlaybackPanel(true);\n    setIsPlaying(true);\n\n    drawPlaybackLine(points);\n\n    if (mapRef.current) {\n      mapRef.current.flyTo({\n        center: [points[0].lng, points[0].lat],\n        zoom: 14,\n      });\n    }\n\n    if (playbackMarkerRef.current) {\n      playbackMarkerRef.current.remove();\n    }\n\n    const el = document.createElement(\"div\");\n    el.innerHTML = `\n      <div class=\"w-8 h-8 bg-red-500 rounded-full flex items-center justify-center shadow-lg border-2 border-white\">\n        <svg class=\"w-4 h-4 text-white\" fill=\"currentColor\" viewBox=\"0 0 24 24\">\n          <path d=\"M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7z\"/>\n        </svg>\n      </div>\n    `;\n\n    const marker = new mapboxgl.Marker({ element: el })\n      .setLngLat([points[0].lng, points[0].lat])\n      .addTo(mapRef.current!);\n\n    playbackMarkerRef.current = marker;\n  };\n\n  const drawPlaybackLine = (points: { lat: number; lng: number }[]) => {\n    const map = mapRef.current!;\n\n    if (map.getLayer(\"playback-line\")) map.removeLayer(\"playback-line\");\n    if (map.getSource(\"playback-line\")) map.removeSource(\"playback-line\");\n\n    map.addSource(\"playback-line\", {\n      type: \"geojson\",\n      data: {\n        type: \"Feature\",\n        properties: {},\n        geometry: {\n          type: \"LineString\",\n          coordinates: points.map((p) => [p.lng, p.lat]),\n        },\n      },\n    });\n\n    map.addLayer({\n      id: \"playback-line\",\n      type: \"line\",\n      source: \"playback-line\",\n      layout: {\n        \"line-join\": \"round\",\n        \"line-cap\": \"round\",\n      },\n      paint: {\n        \"line-color\": \"#3b82f6\",\n        \"line-width\": 4,\n        \"line-opacity\": 0.8,\n      },\n    });\n  };\n\n  // Animation loop\n  useEffect(() => {\n    if (!isPlaying || playbackPoints.length === 0) {\n      if (playbackAnimationRef.current) {\n        cancelAnimationFrame(playbackAnimationRef.current);\n        playbackAnimationRef.current = null;\n      }\n      return;\n    }\n\n    let currentIdx = playbackIdx;\n    const fps = 10 * playbackSpeed;\n    const stepMs = 1000 / fps;\n\n    const loop = () => {\n      if (currentIdx >= playbackPoints.length) {\n        setIsPlaying(false);\n        return;\n      }\n\n      const p = playbackPoints[currentIdx];\n      if (playbackMarkerRef.current) {\n        playbackMarkerRef.current.setLngLat([p.lng, p.lat]);\n      }\n      setPlaybackIdx(currentIdx);\n      currentIdx++;\n\n      playbackAnimationRef.current = requestAnimationFrame(() => {\n        setTimeout(loop, stepMs);\n      });\n    };\n\n    loop();\n\n    return () => {\n      if (playbackAnimationRef.current) {\n        cancelAnimationFrame(playbackAnimationRef.current);\n      }\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [isPlaying, playbackSpeed]);\n\n  const closePlayback = () => {\n    setShowPlaybackPanel(false);\n    setIsPlaying(false);\n    setPlaybackPoints([]);\n    setPlaybackVehicle(null);\n\n    if (playbackMarkerRef.current) {\n      playbackMarkerRef.current.remove();\n      playbackMarkerRef.current = null;\n    }\n\n    const map = mapRef.current;\n    if (map) {\n      if (map.getLayer(\"playback-line\")) map.removeLayer(\"playback-line\");\n      if (map.getSource(\"playback-line\")) map.removeSource(\"playback-line\");\n    }\n  };\n\n  const getStatusIcon = (status?: string | null) => {\n    switch (status) {\n      case \"moving\":\n      case \"online\":\n      case \"in_motion\":\n        return <Activity className=\"w-4 h-4 text-green-400\" />;\n      case \"stopped\":\n      case \"parked\":\n        return <Circle className=\"w-4 h-4 text-amber-400\" />;\n      case \"alert\":\n        return <AlertTriangle className=\"w-4 h-4 text-red-400\" />;\n      default:\n        return <Signal className=\"w-4 h-4 text-slate-400\" />;\n    }\n  };\n\n  const getStatusColor = (status?: string | null) => {\n    switch (status) {\n      case \"moving\":\n      case \"online\":\n      case \"in_motion\":\n        return \"text-green-400 bg-green-500/10\";\n      case \"stopped\":\n      case \"parked\":\n        return \"text-amber-400 bg-amber-500/10\";\n      case \"alert\":\n        return \"text-red-400 bg-red-500/10\";\n      default:\n        return \"text-slate-400 bg-slate-500/10\";\n    }\n  };\n\n  const formatTime = (t?: string | null) => {\n    if (!t) return \"N/A\";\n    const date = new Date(t);\n    const now = new Date();\n    const diffMs = now.getTime() - date.getTime();\n    const diffMins = Math.floor(diffMs / 60000);\n\n    if (diffMins < 1) return \"Just now\";\n    if (diffMins < 60) return `${diffMins}m ago`;\n    if (diffMins < 1440) return `${Math.floor(diffMins / 60)}h ago`;\n    return date.toLocaleDateString();\n  };\n\n  // Convert heading degrees to compass direction\n  const getCompassDirection = (heading: number): string => {\n    const directions = ['N', 'NE', 'E', 'SE', 'S', 'SW', 'W', 'NW'];\n    const index = Math.round(heading / 45) % 8;\n    return directions[index];\n  };\n\n  // --- Geofence creation functions ---\n  const toggleDrawingMode = () => {\n    if (!drawRef.current) return;\n\n    if (isDrawingGeofence) {\n      // Cancel drawing\n      drawRef.current.deleteAll();\n      drawRef.current.changeMode(\"simple_select\");\n      setIsDrawingGeofence(false);\n    } else {\n      // Start drawing\n      drawRef.current.changeMode(\"draw_polygon\");\n      setIsDrawingGeofence(true);\n    }\n  };\n\n  // Convert GeoJSON geometry to WKT format for PostGIS\n  const geoJsonToWkt = (geometry: GeoJSON.Geometry): string => {\n    if (geometry.type === \"Polygon\") {\n      const coords = geometry.coordinates as number[][][];\n      const rings = coords.map((ring) => {\n        const points = ring.map((coord) => `${coord[0]} ${coord[1]}`).join(\", \");\n        return `(${points})`;\n      });\n      return `SRID=4326;POLYGON(${rings.join(\", \")})`;\n    }\n    return \"\";\n  };\n\n  const handleSaveGeofence = async () => {\n    if (!drawnGeometry) {\n      alert(\"Please draw a geofence area on the map\");\n      return;\n    }\n    if (!geofenceForm.name.trim()) {\n      alert(\"Please enter a name for the geofence\");\n      return;\n    }\n\n    try {\n      const wktBoundary = geoJsonToWkt(drawnGeometry);\n      \n      if (!wktBoundary) {\n        alert(\"Invalid geometry. Please draw a polygon.\");\n        return;\n      }\n\n      const { data: { user } } = await supabase.auth.getUser();\n      if (!user) {\n        alert(\"You must be logged in to create a geofence\");\n        return;\n      }\n\n      const { error } = await supabase.from(\"geofences\").insert([{\n        name: geofenceForm.name,\n        description: geofenceForm.description || null,\n        vehicle_id: geofenceForm.vehicle_id || null,\n        type: geofenceForm.type || \"both\",\n        boundary: wktBoundary,\n        user_id: user.id,\n        active: true,\n      }]);\n\n      if (error) {\n        console.error(\"Geofence save error:\", error);\n        alert(`Failed to save geofence: ${error.message}`);\n        return;\n      }\n\n      // Clear everything\n      if (drawRef.current) {\n        drawRef.current.deleteAll();\n      }\n      setShowGeofenceModal(false);\n      setDrawnGeometry(null);\n      setGeofenceForm({ name: \"\", description: \"\", vehicle_id: \"\", type: \"both\" });\n      \n      // Reload geofences\n      loadGeofences();\n      alert(\"Geofence created successfully!\");\n    } catch (err: unknown) {\n      const errorMessage = err instanceof Error ? err.message : \"Failed to save geofence\";\n      console.error(\"Error saving geofence:\", err);\n      alert(`Error: ${errorMessage}`);\n    }\n  };\n\n  const cancelGeofenceCreation = () => {\n    if (drawRef.current) {\n      drawRef.current.deleteAll();\n    }\n    setShowGeofenceModal(false);\n    setDrawnGeometry(null);\n    setIsDrawingGeofence(false);\n    setGeofenceForm({ name: \"\", description: \"\", vehicle_id: \"\", type: \"both\" });\n  };\n\n  return (\n    <div className=\"relative w-full overflow-hidden bg-slate-900\" style={{ height: 'calc(100vh)', minHeight: '100vh' }}>\n      {/* Map Container */}\n      <div ref={mapContainerRef} className=\"absolute inset-0 z-0\" style={{ width: '100%', height: '100%' }} />\n\n      {/* Alert Banner */}\n      {showAlertBanner && liveAlerts.length > 0 && (\n        <div className=\"absolute top-0 left-0 right-0 z-30\">\n          <div className=\"bg-red-500/90 backdrop-blur-sm border-b border-red-600 px-4 py-2 animate-pulse\">\n            <div className=\"flex items-center justify-between max-w-screen-xl mx-auto\">\n              <div className=\"flex items-center gap-3\">\n                <AlertTriangle className=\"w-5 h-5 text-white\" />\n                <span className=\"text-white font-medium\">{liveAlerts[0].message}</span>\n                {liveAlerts.length > 1 && (\n                  <span className=\"bg-white/20 px-2 py-0.5 rounded text-xs text-white\">\n                    +{liveAlerts.length - 1} more\n                  </span>\n                )}\n              </div>\n              <div className=\"flex items-center gap-2\">\n                <button\n                  onClick={() => {\n                    const alertsPanel = document.getElementById('alerts-panel');\n                    if (alertsPanel) alertsPanel.classList.toggle('hidden');\n                  }}\n                  className=\"px-3 py-1 bg-white/20 hover:bg-white/30 rounded text-white text-sm transition-colors\"\n                >\n                  View All\n                </button>\n                <button\n                  onClick={() => setShowAlertBanner(false)}\n                  className=\"p-1 hover:bg-white/20 rounded transition-colors\"\n                >\n                  <X className=\"w-4 h-4 text-white\" />\n                </button>\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* Alerts Panel (toggleable) */}\n      <div \n        id=\"alerts-panel\"\n        className=\"hidden absolute top-16 right-4 z-30 w-96 max-h-96 overflow-y-auto bg-slate-900/95 backdrop-blur-sm border border-slate-700 rounded-xl shadow-2xl\"\n      >\n        <div className=\"p-4 border-b border-slate-700 flex items-center justify-between sticky top-0 bg-slate-900/95 backdrop-blur-sm\">\n          <div className=\"flex items-center gap-2\">\n            <AlertTriangle className=\"w-5 h-5 text-red-400\" />\n            <h3 className=\"text-white font-semibold\">Live Alerts</h3>\n            <span className=\"bg-red-500/20 text-red-400 px-2 py-0.5 rounded text-xs\">{liveAlerts.length}</span>\n          </div>\n          <button\n            onClick={() => setLiveAlerts([])}\n            className=\"text-slate-400 hover:text-white text-sm\"\n          >\n            Clear All\n          </button>\n        </div>\n        <div className=\"p-2 space-y-2\">\n          {liveAlerts.length === 0 ? (\n            <p className=\"text-slate-400 text-center py-4\">No alerts</p>\n          ) : (\n            liveAlerts.map((alert) => (\n              <div \n                key={alert.id}\n                className={`p-3 rounded-lg border ${\n                  alert.severity === 'high' || alert.severity === 'critical'\n                    ? 'bg-red-500/10 border-red-500/30'\n                    : 'bg-amber-500/10 border-amber-500/30'\n                }`}\n              >\n                <div className=\"flex items-start gap-2\">\n                  <AlertTriangle className={`w-4 h-4 mt-0.5 ${\n                    alert.severity === 'high' || alert.severity === 'critical' ? 'text-red-400' : 'text-amber-400'\n                  }`} />\n                  <div className=\"flex-1\">\n                    <p className=\"text-white text-sm\">{alert.message}</p>\n                    <p className=\"text-slate-400 text-xs mt-1\">\n                      {new Date(alert.created_at).toLocaleTimeString()}\n                    </p>\n                  </div>\n                </div>\n              </div>\n            ))\n          )}\n        </div>\n      </div>\n\n      {/* Top Stats Bar */}\n      <div className=\"absolute top-4 left-1/2 -translate-x-1/2 z-10\">\n        <div className=\"flex items-center gap-2 bg-slate-900/90 backdrop-blur-sm rounded-xl p-2 shadow-xl border border-slate-700\">\n          <div className=\"flex items-center gap-2 px-4 py-2 border-r border-slate-700\">\n            <Car className=\"w-5 h-5 text-blue-400\" />\n            <div>\n              <p className=\"text-xs text-slate-400\">Total</p>\n              <p className=\"text-lg font-bold text-white\">{stats.total}</p>\n            </div>\n          </div>\n          <div className=\"flex items-center gap-2 px-4 py-2 border-r border-slate-700\">\n            <Activity className=\"w-5 h-5 text-green-400\" />\n            <div>\n              <p className=\"text-xs text-slate-400\">Moving</p>\n              <p className=\"text-lg font-bold text-green-400\">{stats.moving}</p>\n            </div>\n          </div>\n          <div className=\"flex items-center gap-2 px-4 py-2 border-r border-slate-700\">\n            <Circle className=\"w-5 h-5 text-amber-400\" />\n            <div>\n              <p className=\"text-xs text-slate-400\">Stopped</p>\n              <p className=\"text-lg font-bold text-amber-400\">{stats.stopped}</p>\n            </div>\n          </div>\n          <div className=\"flex items-center gap-2 px-4 py-2 border-r border-slate-700\">\n            <Signal className=\"w-5 h-5 text-slate-400\" />\n            <div>\n              <p className=\"text-xs text-slate-400\">Offline</p>\n              <p className=\"text-lg font-bold text-slate-400\">{stats.offline}</p>\n            </div>\n          </div>\n          \n          {/* Live Connection Status */}\n          <div className=\"flex items-center gap-2 px-4 py-2\">\n            {realtimeStatus === 'connected' ? (\n              <>\n                <div className=\"relative\">\n                  <div className=\"w-3 h-3 bg-green-500 rounded-full\"></div>\n                  <div className=\"absolute inset-0 w-3 h-3 bg-green-500 rounded-full animate-ping\"></div>\n                </div>\n                <div>\n                  <p className=\"text-xs text-green-400 font-medium\">LIVE</p>\n                </div>\n              </>\n            ) : realtimeStatus === 'connecting' ? (\n              <>\n                <div className=\"w-3 h-3 bg-amber-500 rounded-full animate-pulse\"></div>\n                <div>\n                  <p className=\"text-xs text-amber-400 font-medium\">Connecting...</p>\n                </div>\n              </>\n            ) : (\n              <>\n                <div className=\"w-3 h-3 bg-red-500 rounded-full\"></div>\n                <div>\n                  <p className=\"text-xs text-red-400 font-medium\">Disconnected</p>\n                </div>\n              </>\n            )}\n          </div>\n        </div>\n      </div>\n\n      {/* Side Panel */}\n      <div\n        className={`absolute top-0 left-0 h-full z-20 transition-all duration-300 ${\n          isSideOpen ? \"w-96\" : \"w-0\"\n        }`}\n      >\n        <div className=\"h-full bg-slate-900/95 backdrop-blur-sm border-r border-slate-700 flex flex-col overflow-hidden\">\n          {/* Header */}\n          <div className=\"p-4 border-b border-slate-700\">\n            <div className=\"flex items-center justify-between mb-4\">\n              <div className=\"flex items-center gap-3\">\n                <div className=\"w-10 h-10 bg-blue-500/10 rounded-lg flex items-center justify-center\">\n                  <MapPin className=\"w-5 h-5 text-blue-400\" />\n                </div>\n                <div>\n                  <h2 className=\"text-lg font-bold text-white\">Live Tracking</h2>\n                  <p className=\"text-xs text-slate-400\">{filteredVehicles.length} vehicles</p>\n                </div>\n              </div>\n              <button\n                onClick={() => loadVehicles()}\n                className=\"p-2 bg-slate-800 rounded-lg hover:bg-slate-700 transition-colors\"\n                title=\"Refresh\"\n              >\n                <RefreshCcw className={`w-4 h-4 text-slate-400 ${isLoading ? \"animate-spin\" : \"\"}`} />\n              </button>\n            </div>\n\n            {/* Search */}\n            <div className=\"relative mb-3\">\n              <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-500\" />\n              <input\n                value={search}\n                onChange={(e) => setSearch(e.target.value)}\n                placeholder=\"Search vehicles...\"\n                className=\"w-full pl-10 pr-4 py-2.5 bg-slate-800 border border-slate-700 rounded-lg text-white text-sm placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n              />\n            </div>\n\n            {/* Status Filter */}\n            <div className=\"flex gap-2\">\n              {[\n                { value: \"\", label: \"All\" },\n                { value: \"moving\", label: \"Moving\" },\n                { value: \"stopped\", label: \"Stopped\" },\n                { value: \"offline\", label: \"Offline\" },\n              ].map((f) => (\n                <button\n                  key={f.value}\n                  onClick={() => setStatusFilter(f.value)}\n                  className={`flex-1 py-2 text-xs font-medium rounded-lg transition-colors ${\n                    statusFilter === f.value\n                      ? \"bg-blue-500 text-white\"\n                      : \"bg-slate-800 text-slate-400 hover:bg-slate-700\"\n                  }`}\n                >\n                  {f.label}\n                </button>\n              ))}\n            </div>\n          </div>\n\n          {/* Vehicle List */}\n          <div className=\"flex-1 overflow-y-auto p-4 space-y-2\">\n            {isLoading ? (\n              <div className=\"flex items-center justify-center h-40\">\n                <div className=\"animate-spin w-8 h-8 border-2 border-blue-500 border-t-transparent rounded-full\" />\n              </div>\n            ) : filteredVehicles.length === 0 ? (\n              <div className=\"text-center py-12\">\n                <Car className=\"w-12 h-12 text-slate-600 mx-auto mb-3\" />\n                <p className=\"text-slate-400\">No vehicles found</p>\n              </div>\n            ) : (\n              filteredVehicles.map((v) => (\n                <div\n                  key={v.id}\n                  onClick={() => {\n                    setSelectedVehicle(v);\n                    if (v.last_known_location?.lng && v.last_known_location?.lat) {\n                      mapRef.current?.flyTo({\n                        center: [v.last_known_location.lng, v.last_known_location.lat],\n                        zoom: 16,\n                        duration: 1000,\n                      });\n                    }\n                  }}\n                  className={`p-4 rounded-xl cursor-pointer transition-all duration-200 ${\n                    selectedVehicle?.id === v.id\n                      ? \"bg-blue-500/20 border border-blue-500/50\"\n                      : \"bg-slate-800/50 border border-slate-700 hover:bg-slate-800 hover:border-slate-600\"\n                  }`}\n                >\n                  <div className=\"flex items-start justify-between mb-3\">\n                    <div className=\"flex items-center gap-3\">\n                      <div className={`w-10 h-10 rounded-lg flex items-center justify-center ${getStatusColor(v.status)}`}>\n                        <Car className=\"w-5 h-5\" />\n                      </div>\n                      <div>\n                        <h3 className=\"text-white font-semibold\">\n                          {v.registration_number || v.id.slice(0, 8)}\n                        </h3>\n                        <p className=\"text-slate-400 text-xs\">\n                          {v.brand} {v.model}\n                        </p>\n                      </div>\n                    </div>\n                    <div className={`flex items-center gap-1.5 px-2 py-1 rounded-full text-xs font-medium ${getStatusColor(v.status)}`}>\n                      {getStatusIcon(v.status)}\n                      <span className=\"capitalize\">{v.status || \"offline\"}</span>\n                    </div>\n                  </div>\n\n                  <div className=\"grid grid-cols-2 gap-3 mb-3\">\n                    <div className=\"flex items-center gap-2\">\n                      <Clock className=\"w-3.5 h-3.5 text-slate-500\" />\n                      <span className=\"text-slate-400 text-xs\">{formatTime(v.last_update)}</span>\n                    </div>\n                    <div className=\"flex items-center gap-2\">\n                      <Gauge className=\"w-3.5 h-3.5 text-slate-500\" />\n                      <span className=\"text-slate-400 text-xs\">{v.speed || 0} km/h</span>\n                    </div>\n                  </div>\n\n                  <div className=\"flex gap-2\">\n                    <button\n                      onClick={(e) => {\n                        e.stopPropagation();\n                        if (v.last_known_location?.lng && v.last_known_location?.lat) {\n                          mapRef.current?.flyTo({\n                            center: [v.last_known_location.lng, v.last_known_location.lat],\n                            zoom: 17,\n                            duration: 1000,\n                          });\n                        }\n                      }}\n                      className=\"flex-1 flex items-center justify-center gap-1.5 py-2 bg-slate-700 hover:bg-slate-600 rounded-lg text-xs text-slate-300 transition-colors\"\n                    >\n                      <Crosshair className=\"w-3.5 h-3.5\" />\n                      Focus\n                    </button>\n                    <button\n                      onClick={(e) => {\n                        e.stopPropagation();\n                        handleStartPlayback(v, 6);\n                      }}\n                      className=\"flex-1 flex items-center justify-center gap-1.5 py-2 bg-blue-500/10 hover:bg-blue-500/20 rounded-lg text-xs text-blue-400 transition-colors\"\n                    >\n                      <Play className=\"w-3.5 h-3.5\" />\n                      Playback\n                    </button>\n                  </div>\n                </div>\n              ))\n            )}\n          </div>\n        </div>\n      </div>\n\n      {/* Toggle Side Panel Button */}\n      <button\n        onClick={() => setIsSideOpen(!isSideOpen)}\n        className={`absolute top-1/2 -translate-y-1/2 z-30 p-2 bg-slate-800 border border-slate-700 rounded-r-lg shadow-lg hover:bg-slate-700 transition-all duration-300 ${\n          isSideOpen ? \"left-96\" : \"left-0\"\n        }`}\n      >\n        {isSideOpen ? (\n          <ChevronLeft className=\"w-4 h-4 text-slate-400\" />\n        ) : (\n          <ChevronRight className=\"w-4 h-4 text-slate-400\" />\n        )}\n      </button>\n\n      {/* Map Controls - Top Right */}\n      <div className=\"absolute top-20 right-4 z-10 flex flex-col gap-2\">\n        {/* Geofence Toggle */}\n        <button\n          onClick={() => setShowGeofences(!showGeofences)}\n          className={`p-3 border rounded-lg shadow-lg transition-colors ${\n            showGeofences\n              ? \"bg-blue-500/20 border-blue-500/50 hover:bg-blue-500/30\"\n              : \"bg-slate-800 border-slate-700 hover:bg-slate-700\"\n          }`}\n          title={showGeofences ? \"Hide Geofences\" : \"Show Geofences\"}\n        >\n          {showGeofences ? (\n            <Eye className=\"w-5 h-5 text-blue-400\" />\n          ) : (\n            <EyeOff className=\"w-5 h-5 text-slate-400\" />\n          )}\n        </button>\n\n        {/* Create Geofence */}\n        <button\n          onClick={toggleDrawingMode}\n          className={`p-3 border rounded-lg shadow-lg transition-colors ${\n            isDrawingGeofence\n              ? \"bg-green-500/20 border-green-500 text-green-400\"\n              : \"bg-slate-800 border-slate-700 hover:bg-slate-700 text-slate-400\"\n          }`}\n          title={isDrawingGeofence ? \"Cancel Drawing\" : \"Create Geofence\"}\n        >\n          {isDrawingGeofence ? (\n            <X className=\"w-5 h-5\" />\n          ) : (\n            <Shield className=\"w-5 h-5\" />\n          )}\n        </button>\n\n        {/* Style Picker */}\n        <div className=\"relative\">\n          <button\n            onClick={() => setShowStylePicker(!showStylePicker)}\n            className=\"p-3 bg-slate-800 border border-slate-700 rounded-lg shadow-lg hover:bg-slate-700 transition-colors\"\n            title=\"Map Style\"\n          >\n            <Layers className=\"w-5 h-5 text-slate-400\" />\n          </button>\n          {showStylePicker && (\n            <div className=\"absolute top-full right-0 mt-2 bg-slate-800 border border-slate-700 rounded-lg shadow-xl overflow-hidden\">\n              {Object.keys(MAP_STYLES).map((style) => (\n                <button\n                  key={style}\n                  onClick={() => {\n                    setMapStyle(style as keyof typeof MAP_STYLES);\n                    setShowStylePicker(false);\n                  }}\n                  className={`block w-full px-4 py-2 text-left text-sm capitalize hover:bg-slate-700 transition-colors ${\n                    mapStyle === style\n                      ? \"bg-blue-500/10 text-blue-400\"\n                      : \"text-slate-300\"\n                  }`}\n                >\n                  {style}\n                </button>\n              ))}\n            </div>\n          )}\n        </div>\n      </div>\n\n      {/* Drawing Mode Indicator */}\n      {isDrawingGeofence && (\n        <div className=\"absolute top-20 left-1/2 -translate-x-1/2 z-10\">\n          <div className=\"bg-green-500/20 backdrop-blur-sm rounded-lg px-4 py-2 shadow-lg border border-green-500 flex items-center gap-3\">\n            <Shield className=\"w-5 h-5 text-green-400\" />\n            <span className=\"text-green-400 text-sm font-medium\">\n              Drawing Mode: Click on the map to draw a geofence polygon\n            </span>\n            <button\n              onClick={toggleDrawingMode}\n              className=\"text-green-400 hover:text-green-300\"\n            >\n              <X className=\"w-4 h-4\" />\n            </button>\n          </div>\n        </div>\n      )}\n\n      {/* Geofence Legend */}\n      {showGeofences && geofences.length > 0 && (\n        <div className=\"absolute top-20 left-1/2 -translate-x-1/2 z-10\">\n          <div className=\"bg-slate-900/90 backdrop-blur-sm rounded-lg p-2 shadow-lg border border-slate-700 flex items-center gap-4\">\n            <div className=\"flex items-center gap-1.5\">\n              <div className=\"w-3 h-3 bg-blue-500/30 border border-blue-500 rounded\"></div>\n              <span className=\"text-xs text-slate-400\">Both</span>\n            </div>\n            <div className=\"flex items-center gap-1.5\">\n              <div className=\"w-3 h-3 bg-green-500/30 border border-green-500 rounded\"></div>\n              <span className=\"text-xs text-slate-400\">Entry</span>\n            </div>\n            <div className=\"flex items-center gap-1.5\">\n              <div className=\"w-3 h-3 bg-red-500/30 border border-red-500 rounded\"></div>\n              <span className=\"text-xs text-slate-400\">Exit</span>\n            </div>\n            <span className=\"text-xs text-slate-500 ml-2\">({geofences.length} geofences)</span>\n          </div>\n        </div>\n      )}\n\n      {/* Playback Panel */}\n      {showPlaybackPanel && (\n        <div className=\"absolute bottom-4 left-1/2 -translate-x-1/2 z-20 w-full max-w-2xl px-4\">\n          <div className=\"bg-slate-900/95 backdrop-blur-sm border border-slate-700 rounded-xl p-4 shadow-xl\">\n            <div className=\"flex items-center justify-between mb-4\">\n              <div className=\"flex items-center gap-3\">\n                <div className=\"w-10 h-10 bg-red-500/10 rounded-lg flex items-center justify-center\">\n                  <Navigation className=\"w-5 h-5 text-red-400\" />\n                </div>\n                <div>\n                  <h3 className=\"text-white font-semibold\">\n                    {playbackVehicle?.registration_number || \"Vehicle\"} - Route Playback\n                  </h3>\n                  <p className=\"text-slate-400 text-xs\">\n                    {playbackPoints[playbackIdx]?.timestamp\n                      ? new Date(playbackPoints[playbackIdx].timestamp).toLocaleString()\n                      : \"\"}\n                  </p>\n                </div>\n              </div>\n              <button\n                onClick={closePlayback}\n                className=\"p-2 bg-slate-800 rounded-lg hover:bg-slate-700 transition-colors\"\n              >\n                <X className=\"w-4 h-4 text-slate-400\" />\n              </button>\n            </div>\n\n            {/* Progress Bar */}\n            <div className=\"mb-4\">\n              <input\n                type=\"range\"\n                min={0}\n                max={Math.max(0, playbackDuration)}\n                value={playbackIdx}\n                onChange={(e) => {\n                  const val = Number(e.target.value);\n                  setPlaybackIdx(val);\n                  if (playbackMarkerRef.current && playbackPoints[val]) {\n                    playbackMarkerRef.current.setLngLat([\n                      playbackPoints[val].lng,\n                      playbackPoints[val].lat,\n                    ]);\n                  }\n                }}\n                className=\"w-full h-2 bg-slate-700 rounded-full appearance-none cursor-pointer [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:w-4 [&::-webkit-slider-thumb]:h-4 [&::-webkit-slider-thumb]:bg-blue-500 [&::-webkit-slider-thumb]:rounded-full [&::-webkit-slider-thumb]:cursor-pointer\"\n              />\n              <div className=\"flex justify-between mt-1 text-xs text-slate-500\">\n                <span>{playbackIdx + 1} / {playbackDuration + 1} points</span>\n                <span>{playbackPoints[playbackIdx]?.speed || 0} km/h</span>\n              </div>\n            </div>\n\n            {/* Controls */}\n            <div className=\"flex items-center justify-center gap-4\">\n              <button\n                onClick={() => {\n                  const newIdx = Math.max(0, playbackIdx - 10);\n                  setPlaybackIdx(newIdx);\n                  if (playbackMarkerRef.current && playbackPoints[newIdx]) {\n                    playbackMarkerRef.current.setLngLat([\n                      playbackPoints[newIdx].lng,\n                      playbackPoints[newIdx].lat,\n                    ]);\n                  }\n                }}\n                className=\"p-2 bg-slate-800 rounded-lg hover:bg-slate-700 transition-colors\"\n              >\n                <SkipBack className=\"w-5 h-5 text-slate-400\" />\n              </button>\n\n              <button\n                onClick={() => setIsPlaying(!isPlaying)}\n                className=\"p-4 bg-blue-500 rounded-full hover:bg-blue-600 transition-colors\"\n              >\n                {isPlaying ? (\n                  <Pause className=\"w-6 h-6 text-white\" />\n                ) : (\n                  <Play className=\"w-6 h-6 text-white\" />\n                )}\n              </button>\n\n              <button\n                onClick={() => {\n                  const newIdx = Math.min(playbackDuration, playbackIdx + 10);\n                  setPlaybackIdx(newIdx);\n                  if (playbackMarkerRef.current && playbackPoints[newIdx]) {\n                    playbackMarkerRef.current.setLngLat([\n                      playbackPoints[newIdx].lng,\n                      playbackPoints[newIdx].lat,\n                    ]);\n                  }\n                }}\n                className=\"p-2 bg-slate-800 rounded-lg hover:bg-slate-700 transition-colors\"\n              >\n                <SkipForward className=\"w-5 h-5 text-slate-400\" />\n              </button>\n\n              {/* Speed Control */}\n              <div className=\"flex items-center gap-2 ml-4 px-3 py-1 bg-slate-800 rounded-lg\">\n                <span className=\"text-xs text-slate-400\">Speed:</span>\n                {[0.5, 1, 2, 4].map((speed) => (\n                  <button\n                    key={speed}\n                    onClick={() => setPlaybackSpeed(speed)}\n                    className={`px-2 py-1 text-xs rounded ${\n                      playbackSpeed === speed\n                        ? \"bg-blue-500 text-white\"\n                        : \"text-slate-400 hover:text-white\"\n                    }`}\n                  >\n                    {speed}x\n                  </button>\n                ))}\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* Selected Vehicle Info Panel - Enhanced with Live Stats */}\n      {selectedVehicle && !showPlaybackPanel && (\n        <div className=\"absolute bottom-4 left-1/2 -translate-x-1/2 z-20 max-w-4xl w-full px-4\">\n          <div className=\"bg-slate-900/95 backdrop-blur-sm border border-slate-700 rounded-xl shadow-xl overflow-hidden\">\n            {/* Live indicator */}\n            <div className=\"bg-gradient-to-r from-green-500/20 to-blue-500/20 px-4 py-2 border-b border-slate-700 flex items-center justify-between\">\n              <div className=\"flex items-center gap-2\">\n                <div className=\"w-2 h-2 bg-green-500 rounded-full animate-pulse\" />\n                <span className=\"text-green-400 text-xs font-medium\">LIVE TRACKING</span>\n                <span className=\"text-slate-500 text-xs\">|</span>\n                <Radio className=\"w-3 h-3 text-blue-400\" />\n                <span className=\"text-slate-400 text-xs\">Real-time updates</span>\n              </div>\n              <span className=\"text-slate-500 text-xs\">\n                Last update: {formatTime(selectedVehicle.last_update)}\n              </span>\n            </div>\n\n            <div className=\"p-4 flex items-center gap-4 flex-wrap\">\n              {/* Vehicle Identity */}\n              <div className=\"flex items-center gap-3\">\n                <div className={`w-14 h-14 rounded-xl flex items-center justify-center ${getStatusColor(selectedVehicle.status)}`}>\n                  <Car className=\"w-7 h-7\" />\n                </div>\n                <div>\n                  <h3 className=\"text-white font-bold text-lg\">\n                    {selectedVehicle.registration_number || selectedVehicle.id.slice(0, 8)}\n                  </h3>\n                  <p className=\"text-slate-400 text-sm\">\n                    {selectedVehicle.brand} {selectedVehicle.model}\n                  </p>\n                </div>\n              </div>\n\n              {/* Divider */}\n              <div className=\"h-12 w-px bg-slate-700\" />\n\n              {/* Status */}\n              <div className=\"text-center min-w-[70px]\">\n                <div className=\"flex items-center justify-center gap-1 mb-1\">\n                  <Activity className=\"w-3 h-3 text-slate-400\" />\n                  <p className=\"text-xs text-slate-400\">Status</p>\n                </div>\n                <p className={`font-bold capitalize text-sm ${\n                  selectedVehicle.status === 'moving' || selectedVehicle.status === 'online' || selectedVehicle.status === 'in_motion' \n                    ? 'text-green-400' \n                    : selectedVehicle.status === 'stopped' || selectedVehicle.status === 'parked'\n                    ? 'text-amber-400'\n                    : 'text-slate-400'\n                }`}>\n                  {selectedVehicle.status || \"Offline\"}\n                </p>\n              </div>\n\n              {/* Speed */}\n              <div className=\"text-center min-w-[70px]\">\n                <div className=\"flex items-center justify-center gap-1 mb-1\">\n                  <Gauge className=\"w-3 h-3 text-slate-400\" />\n                  <p className=\"text-xs text-slate-400\">Speed</p>\n                </div>\n                <p className=\"text-white font-bold text-sm\">\n                  <span className={selectedVehicle.speed && selectedVehicle.speed > 80 ? 'text-red-400' : 'text-white'}>\n                    {selectedVehicle.speed?.toFixed(1) || '0'}\n                  </span>\n                  <span className=\"text-slate-500 text-xs ml-1\">km/h</span>\n                </p>\n              </div>\n\n              {/* Heading */}\n              <div className=\"text-center min-w-[70px]\">\n                <div className=\"flex items-center justify-center gap-1 mb-1\">\n                  <Compass className=\"w-3 h-3 text-slate-400\" />\n                  <p className=\"text-xs text-slate-400\">Heading</p>\n                </div>\n                <p className=\"text-white font-bold text-sm\">\n                  {selectedVehicle.heading ? `${selectedVehicle.heading.toFixed(0)}¬∞` : '‚Äî'}\n                  <span className=\"text-slate-500 text-xs ml-1\">\n                    {selectedVehicle.heading ? getCompassDirection(selectedVehicle.heading) : ''}\n                  </span>\n                </p>\n              </div>\n\n              {/* Coordinates */}\n              <div className=\"text-center min-w-[120px]\">\n                <div className=\"flex items-center justify-center gap-1 mb-1\">\n                  <MapPin className=\"w-3 h-3 text-slate-400\" />\n                  <p className=\"text-xs text-slate-400\">Coordinates</p>\n                </div>\n                <p className=\"text-white font-mono text-xs\">\n                  {selectedVehicle.latitude?.toFixed(6) || selectedVehicle.last_known_location?.lat?.toFixed(6) || '‚Äî'},\n                  {selectedVehicle.longitude?.toFixed(6) || selectedVehicle.last_known_location?.lng?.toFixed(6) || '‚Äî'}\n                </p>\n              </div>\n\n              {/* Ignition */}\n              <div className=\"text-center min-w-[70px]\">\n                <div className=\"flex items-center justify-center gap-1 mb-1\">\n                  <Zap className=\"w-3 h-3 text-slate-400\" />\n                  <p className=\"text-xs text-slate-400\">Ignition</p>\n                </div>\n                <p className={`font-bold text-sm ${selectedVehicle.ignition_status ? 'text-green-400' : 'text-slate-500'}`}>\n                  {selectedVehicle.ignition_status ? 'ON' : 'OFF'}\n                </p>\n              </div>\n\n              {/* Spacer */}\n              <div className=\"flex-1\" />\n\n              {/* Actions */}\n              <div className=\"flex items-center gap-2\">\n                <button\n                  onClick={() => handleStartPlayback(selectedVehicle, 6)}\n                  className=\"flex items-center gap-2 px-4 py-2.5 bg-blue-500 hover:bg-blue-600 rounded-lg text-white text-sm font-medium transition-colors\"\n                >\n                  <Play className=\"w-4 h-4\" />\n                  History\n                </button>\n                <button\n                  onClick={() => {\n                    if (mapRef.current && selectedVehicle.last_known_location) {\n                      mapRef.current.flyTo({\n                        center: [\n                          selectedVehicle.last_known_location.lng!,\n                          selectedVehicle.last_known_location.lat!\n                        ],\n                        zoom: 16,\n                        essential: true\n                      });\n                    }\n                  }}\n                  className=\"p-2.5 bg-slate-800 rounded-lg hover:bg-slate-700 transition-colors\"\n                  title=\"Center on vehicle\"\n                >\n                  <Crosshair className=\"w-4 h-4 text-slate-400\" />\n                </button>\n                <button\n                  onClick={() => setSelectedVehicle(null)}\n                  className=\"p-2.5 bg-slate-800 rounded-lg hover:bg-slate-700 transition-colors\"\n                >\n                  <X className=\"w-4 h-4 text-slate-400\" />\n                </button>\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* Geofence Creation Modal */}\n      {showGeofenceModal && (\n        <div className=\"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50\">\n          <div className=\"bg-slate-800 border border-slate-700 rounded-xl p-6 w-full max-w-md shadow-2xl\">\n            <div className=\"flex items-center justify-between mb-6\">\n              <div className=\"flex items-center gap-3\">\n                <div className=\"w-10 h-10 bg-green-500/10 rounded-lg flex items-center justify-center\">\n                  <Shield className=\"w-5 h-5 text-green-400\" />\n                </div>\n                <h2 className=\"text-xl font-semibold text-white\">Create Geofence</h2>\n              </div>\n              <button\n                onClick={cancelGeofenceCreation}\n                className=\"p-2 hover:bg-slate-700 rounded-lg transition-colors\"\n              >\n                <X className=\"w-5 h-5 text-slate-400\" />\n              </button>\n            </div>\n\n            <div className=\"space-y-4\">\n              <div>\n                <label className=\"block text-sm font-medium text-slate-300 mb-2\">\n                  Geofence Name *\n                </label>\n                <input\n                  type=\"text\"\n                  value={geofenceForm.name}\n                  onChange={(e) => setGeofenceForm({ ...geofenceForm, name: e.target.value })}\n                  placeholder=\"e.g., Warehouse Zone, Parking Area\"\n                  className=\"w-full px-4 py-3 bg-slate-900 border border-slate-600 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-green-500/50 focus:border-green-500\"\n                />\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-slate-300 mb-2\">\n                  Description\n                </label>\n                <textarea\n                  value={geofenceForm.description}\n                  onChange={(e) => setGeofenceForm({ ...geofenceForm, description: e.target.value })}\n                  placeholder=\"Optional description...\"\n                  rows={2}\n                  className=\"w-full px-4 py-3 bg-slate-900 border border-slate-600 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-green-500/50 focus:border-green-500 resize-none\"\n                />\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-slate-300 mb-2\">\n                  Alert Type\n                </label>\n                <select\n                  value={geofenceForm.type}\n                  onChange={(e) => setGeofenceForm({ ...geofenceForm, type: e.target.value })}\n                  className=\"w-full px-4 py-3 bg-slate-900 border border-slate-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-green-500/50 focus:border-green-500\"\n                >\n                  <option value=\"both\">Both (Entry & Exit)</option>\n                  <option value=\"entry\">Entry Only</option>\n                  <option value=\"exit\">Exit Only</option>\n                </select>\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-slate-300 mb-2\">\n                  Assign to Vehicle (Optional)\n                </label>\n                <select\n                  value={geofenceForm.vehicle_id}\n                  onChange={(e) => setGeofenceForm({ ...geofenceForm, vehicle_id: e.target.value })}\n                  className=\"w-full px-4 py-3 bg-slate-900 border border-slate-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-green-500/50 focus:border-green-500\"\n                >\n                  <option value=\"\">All Vehicles</option>\n                  {vehicles.map((v) => (\n                    <option key={v.id} value={v.id}>\n                      {v.registration_number} {v.vehicle_type ? `- ${v.vehicle_type}` : \"\"}\n                    </option>\n                  ))}\n                </select>\n              </div>\n            </div>\n\n            <div className=\"flex gap-3 mt-6\">\n              <button\n                onClick={cancelGeofenceCreation}\n                className=\"flex-1 px-4 py-3 bg-slate-700 hover:bg-slate-600 rounded-lg text-white font-medium transition-colors\"\n              >\n                Cancel\n              </button>\n              <button\n                onClick={handleSaveGeofence}\n                className=\"flex-1 px-4 py-3 bg-green-500 hover:bg-green-600 rounded-lg text-white font-medium transition-colors flex items-center justify-center gap-2\"\n              >\n                <Shield className=\"w-4 h-4\" />\n                Save Geofence\n              </button>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* Custom CSS for markers */}\n      <style jsx global>{`\n        .vehicle-marker {\n          z-index: 1;\n        }\n        .vehicle-marker:hover {\n          z-index: 10;\n        }\n        .mapboxgl-popup-content {\n          background: rgb(15 23 42) !important;\n          color: white !important;\n          border-radius: 12px !important;\n          padding: 16px !important;\n          border: 1px solid rgb(51 65 85) !important;\n        }\n        .mapboxgl-popup-tip {\n          border-top-color: rgb(15 23 42) !important;\n        }\n        .mapboxgl-ctrl-group {\n          background: rgb(30 41 59) !important;\n          border: 1px solid rgb(51 65 85) !important;\n        }\n        .mapboxgl-ctrl-group button {\n          background: transparent !important;\n        }\n        .mapboxgl-ctrl-group button:hover {\n          background: rgb(51 65 85) !important;\n        }\n        .mapboxgl-ctrl-icon {\n          filter: invert(1) !important;\n        }\n      `}</style>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}}]
}